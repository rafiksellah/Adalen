{% extends 'base.html.twig' %}

{% block title %}{{ 'home.title'|trans }}{% endblock %}

{% block body %}
    <!-- Hero Section -->
    <section id="hero" class="hero section position-relative" style="min-height: 65vh; overflow: hidden;">
        <!-- Image de fond -->
        <div class="hero-bg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('{{ asset('assets/img/hero.jpg') }}'); background-size: cover; background-position: center; z-index: 1;"></div>
        
        <!-- Overlay léger -->
        <div class="hero-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4); z-index: 2;"></div>
        
        <!-- Contenu -->
        <div class="container" style="position: relative; z-index: 10; padding: 5rem 0; margin-top: 8rem;">
            <div class="row align-items-center">
                <div class="col-lg-10 mx-auto text-center text-white">
                    <h1 class="display-4 fw-bold mb-3 fade-in" style="color: var(--adalen-primary); text-shadow: 2px 2px 8px rgba(0,0,0,0.8);">
                        {{ 'home.hero.title'|trans }}
                    </h1>
                    <p class="lead mb-2 fs-5 fade-in" style="text-shadow: 1px 1px 4px rgba(0,0,0,0.5);">
                        {{ 'home.hero.subtitle'|trans }}
                    </p>
                    <p class="mb-0 fs-6 fade-in" style="text-shadow: 1px 1px 4px rgba(0,0,0,0.5);">
                        {{ 'home.hero.description'|trans }}
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Activities Section -->
    <section class="py-5" style="padding: 6rem 0;">
        <div class="container">
            <h2 class="section-title fade-in">{{ 'home.activities.title'|trans }}</h2>
            <p class="section-subtitle fade-in">{{ 'home.activities.subtitle'|trans }}</p>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4">
                    <div class="activity-card scale-in">
                        <img src="{{ asset('assets/img/image5.jpg') }}" alt="Jardinage" class="activity-image">
                        <div class="activity-card-content">
                            <div class="activity-icon"><i class="fas fa-seedling"></i></div>
                            <h3 class="activity-title">{{ 'activity.gardening.title'|trans }}</h3>
                            <p class="activity-description">{{ 'activity.gardening.description'|trans }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="activity-card scale-in">
                        <img src="{{ asset('assets/img/image3.jpg') }}" alt="Arts Plastiques" class="activity-image">
                        <div class="activity-card-content">
                            <div class="activity-icon"><i class="fas fa-palette"></i></div>
                            <h3 class="activity-title">{{ 'activity.arts.title'|trans }}</h3>
                            <p class="activity-description">{{ 'activity.arts.description'|trans }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="activity-card scale-in">
                        <img src="{{ asset('assets/img/IMG_20251216_142928.jpg') }}" alt="English Bites" class="activity-image">
                        <div class="activity-card-content">
                            <div class="activity-icon"><i class="fas fa-book-open"></i></div>
                            <h3 class="activity-title">{{ 'activity.english.title'|trans }}</h3>
                            <p class="activity-description">{{ 'activity.english.description'|trans }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="activity-card scale-in">
                        <img src="{{ asset('assets/img/image2.jpg') }}" alt="{{ 'activity.archaeology.title'|trans }}" class="activity-image">
                        <div class="activity-card-content">
                            <div class="activity-icon"><i class="fas fa-monument"></i></div>
                            <h3 class="activity-title">{{ 'activity.archaeology.title'|trans }}</h3>
                            <p class="activity-description">{{ 'activity.archaeology.description'|trans }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="activity-card scale-in">
                        <img src="{{ asset('assets/img/IMG_20251216_130007.jpg') }}" alt="{{ 'activity.geology.title'|trans }}" class="activity-image">
                        <div class="activity-card-content">
                            <div class="activity-icon"><i class="fas fa-mountain"></i></div>
                            <h3 class="activity-title">{{ 'activity.geology.title'|trans }}</h3>
                            <p class="activity-description">{{ 'activity.geology.description'|trans }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="activity-card scale-in">
                        <img src="{{ asset('assets/img/IMG_20251118_135319.jpg') }}" alt="{{ 'activity.cultural.title'|trans }}" class="activity-image">
                        <div class="activity-card-content">
                            <div class="activity-icon"><i class="fas fa-landmark"></i></div>
                            <h3 class="activity-title">{{ 'activity.cultural.title'|trans }}</h3>
                            <p class="activity-description">{{ 'activity.cultural.description'|trans }}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center mt-5 fade-in">
                <a href="{{ path('app_activities', {_locale: app.request.locale}) }}" class="btn btn-primary btn-lg">
                    {{ 'home.activities.see_all'|trans }} <i class="fas fa-arrow-right ms-2"></i>
                </a>
            </div>
        </div>
    </section>

    <!-- Quality Section -->
    <section class="quality-section">
        <div class="container">
            <h2 class="section-title fade-in">{{ 'home.quality.title'|trans }}</h2>
            <p class="section-subtitle fade-in">{{ 'home.quality.subtitle'|trans }}</p>
            <div class="row align-items-center g-5 mb-5">
                <div class="col-lg-6 order-lg-2 fade-in-right">
                    <img src="{{ asset('assets/img/IMG_20251216_151941.jpg') }}" alt="Qualité & Environnement" class="img-fluid">
                </div>
                <div class="col-lg-6 order-lg-1 fade-in-left">
                    <p class="lead">{{ 'home.quality.description'|trans }}</p>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-md-6 col-lg-3">
                    <div class="quality-item scale-in">
                        <div class="quality-icon"><i class="fas fa-smile"></i></div>
                        <h4 class="quality-title">{{ 'home.quality.items.happy'|trans }}</h4>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="quality-item scale-in">
                        <div class="quality-icon"><i class="fas fa-puzzle-piece"></i></div>
                        <h4 class="quality-title">{{ 'home.quality.items.play'|trans }}</h4>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="quality-item scale-in">
                        <div class="quality-icon"><i class="fas fa-shield-alt"></i></div>
                        <h4 class="quality-title">{{ 'home.quality.items.safety'|trans }}</h4>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="quality-item scale-in">
                        <div class="quality-icon"><i class="fas fa-lightbulb"></i></div>
                        <h4 class="quality-title">{{ 'home.quality.items.creativity'|trans }}</h4>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Popup Actualité -->
    {% if latestActuality %}
    <div class="modal fade" id="actualityModal" tabindex="-1" aria-labelledby="actualityModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    {% set title = '' %}
                    {% if app.request.locale == 'fr' %}
                        {% set title = latestActuality.titleFr|default(latestActuality.titleEn|default(latestActuality.titleAr)) %}
                    {% elseif app.request.locale == 'en' %}
                        {% set title = latestActuality.titleEn|default(latestActuality.titleFr|default(latestActuality.titleAr)) %}
                    {% elseif app.request.locale == 'ar' %}
                        {% set title = latestActuality.titleAr|default(latestActuality.titleFr|default(latestActuality.titleEn)) %}
                    {% endif %}
                    {% if title and title|trim %}
                        <h5 class="modal-title" id="actualityModalLabel">
                            <i class="fas fa-newspaper me-2"></i>
                            {{ title }}
                        </h5>
                    {% else %}
                        <h5 class="modal-title" id="actualityModalLabel">
                            <i class="fas fa-newspaper me-2"></i>
                            {% if app.request.locale == 'fr' %}Actualité{% elseif app.request.locale == 'en' %}News{% else %}أخبار{% endif %}
                        </h5>
                    {% endif %}
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="actuality-content">
                        {% set description = '' %}
                        {% if app.request.locale == 'fr' %}
                            {% set description = latestActuality.descriptionFr|default(latestActuality.descriptionEn|default(latestActuality.descriptionAr)) %}
                        {% elseif app.request.locale == 'en' %}
                            {% set description = latestActuality.descriptionEn|default(latestActuality.descriptionFr|default(latestActuality.descriptionAr)) %}
                        {% elseif app.request.locale == 'ar' %}
                            {% set description = latestActuality.descriptionAr|default(latestActuality.descriptionFr|default(latestActuality.descriptionEn)) %}
                        {% endif %}
                        {% if description and description|trim %}
                            <p class="mb-3">{{ description|nl2br }}</p>
                        {% endif %}
                        
                        {% set hasImages = latestActuality.images and latestActuality.images|trim %}
                        {% set hasVideo = latestActuality.video and latestActuality.video|trim %}
                        {% set imageList = hasImages ? latestActuality.images|split(',') : [] %}
                        {% set totalItems = imageList|length + (hasVideo ? 1 : 0) %}
                        
                        {% if totalItems > 0 %}
                            <div class="actuality-media mb-3">
                                {% if totalItems > 1 %}
                                    <!-- Carousel pour plusieurs médias -->
                                    <div id="actualityCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="7000">
                                        <div class="carousel-inner rounded">
                                            {% if hasVideo %}
                                                <div class="carousel-item active">
                                                    <div class="d-flex justify-content-center align-items-center" style="min-height: 400px; background: #000;">
                                                        <video controls class="w-100" style="max-height: 500px;">
                                                            <source src="{{ asset(latestActuality.video|trim) }}" type="video/mp4">
                                                            Votre navigateur ne supporte pas la lecture de vidéos.
                                                        </video>
                                                    </div>
                                                </div>
                                            {% endif %}
                                            {% for image in imageList %}
                                                {% if image|trim %}
                                                    <div class="carousel-item {% if not hasVideo and loop.first %}active{% endif %}">
                                                        <div class="d-flex justify-content-center align-items-center" style="min-height: 400px; background: #f8f9fa;">
                                                            <img src="{{ asset(image|trim) }}" alt="{% if app.request.locale == 'fr' %}{{ latestActuality.titleFr|default('') }}{% elseif app.request.locale == 'en' %}{{ latestActuality.titleEn|default('') }}{% elseif app.request.locale == 'ar' %}{{ latestActuality.titleAr|default('') }}{% endif %}" class="img-fluid" style="max-height: 500px; width: auto; object-fit: contain;">
                                                        </div>
                                                    </div>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                        <button class="carousel-control-prev" type="button" data-bs-target="#actualityCarousel" data-bs-slide="prev">
                                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Précédent</span>
                                        </button>
                                        <button class="carousel-control-next" type="button" data-bs-target="#actualityCarousel" data-bs-slide="next">
                                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Suivant</span>
                                        </button>
                                        <div class="carousel-indicators">
                                            {% if hasVideo %}
                                                <button type="button" data-bs-target="#actualityCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Vidéo"></button>
                                            {% endif %}
                                            {% for image in imageList %}
                                                {% if image|trim %}
                                                    <button type="button" data-bs-target="#actualityCarousel" data-bs-slide-to="{{ loop.index0 + (hasVideo ? 1 : 0) }}" {% if not hasVideo and loop.first %}class="active" aria-current="true"{% endif %} aria-label="Image {{ loop.index }}"></button>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                {% else %}
                                    <!-- Affichage simple pour un seul média -->
                                    {% if hasVideo %}
                                        <div class="d-flex justify-content-center align-items-center" style="min-height: 400px; background: #000;">
                                            <video controls class="w-100" style="max-height: 500px;">
                                                <source src="{{ asset(latestActuality.video|trim) }}" type="video/mp4">
                                                Votre navigateur ne supporte pas la lecture de vidéos.
                                            </video>
                                        </div>
                                    {% elseif imageList|length == 1 %}
                                        <div class="d-flex justify-content-center align-items-center" style="min-height: 400px; background: #f8f9fa;">
                                            <img src="{{ asset(imageList[0]|trim) }}" alt="{% if app.request.locale == 'fr' %}{{ latestActuality.titleFr|default('') }}{% elseif app.request.locale == 'en' %}{{ latestActuality.titleEn|default('') }}{% elseif app.request.locale == 'ar' %}{{ latestActuality.titleAr|default('') }}{% endif %}" class="img-fluid" style="max-height: 500px; width: auto; object-fit: contain;">
                                        </div>
                                    {% endif %}
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
                        <i class="fas fa-check me-2"></i>
                        J'ai compris
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {% if latestActuality %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const modalElement = document.getElementById('actualityModal');
            if (!modalElement) return;
            
            const modal = new bootstrap.Modal(modalElement);
            const actualityId = {{ latestActuality.id }};
            const storageKey = 'adalen_last_actuality_id';
            
            // Récupérer l'ID de la dernière actualité vue
            const lastSeenActualityId = localStorage.getItem(storageKey);
            
            // Afficher la popup à chaque rafraîchissement
            // Si c'est une nouvelle actualité, elle remplacera l'ancienne automatiquement
            setTimeout(function() {
                modal.show();
            }, 1000);
            
            // Mettre à jour l'ID de la dernière actualité vue quand la popup est fermée
            modalElement.addEventListener('hidden.bs.modal', function() {
                localStorage.setItem(storageKey, actualityId.toString());
            });
        });
    </script>
    {% endif %}
{% endblock %}
