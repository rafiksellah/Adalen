{% extends 'base.html.twig' %}

{% block title %}{{ 'home.title'|trans }}{% endblock %}

{% block body %}
    <!-- Hero Section - Carrousel -->
    <section id="hero" class="hero section position-relative" style="min-height: 65vh; overflow: hidden;">
        <div id="heroCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel" data-bs-interval="5000">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="3" aria-label="Slide 4"></button>
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="4" aria-label="Slide 5"></button>
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="5" aria-label="Slide 6"></button>
            </div>
            <div class="carousel-inner">
                <!-- Slide 1: Créativité -->
                <div class="carousel-item active">
                    <div class="hero-slide" style="background-image: url('{{ asset('assets/img/hero.jpg') }}'); background-size: cover; background-position: center; min-height: 65vh; position: relative;">
                        <div class="hero-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4);"></div>
                        <div class="container" style="position: relative; z-index: 10; height: 65vh; display: flex; align-items: center; justify-content: center;">
                            <div class="text-center text-white">
                                <h1 class="display-3 fw-bold mb-2" style="color: var(--adalen-primary); text-shadow: 2px 2px 8px rgba(0,0,0,0.8);">ADALEN</h1>
                                <p class="lead mb-4" style="text-shadow: 1px 1px 4px rgba(0,0,0,0.8); font-size: 1.1rem;">{{ 'home.hero.carousel.description'|trans }}</p>
                                <h2 class="display-5 fw-bold" style="color: white; text-shadow: 2px 2px 8px rgba(0,0,0,0.8);">{{ 'home.hero.carousel.keywords.creativity'|trans }}</h2>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Slide 2: Nature -->
                <div class="carousel-item">
                    <div class="hero-slide" style="background-image: url('{{ asset('assets/img/hero.jpg') }}'); background-size: cover; background-position: center; min-height: 65vh; position: relative;">
                        <div class="hero-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4);"></div>
                        <div class="container" style="position: relative; z-index: 10; height: 65vh; display: flex; align-items: center; justify-content: center;">
                            <div class="text-center text-white">
                                <h1 class="display-3 fw-bold mb-2" style="color: var(--adalen-primary); text-shadow: 2px 2px 8px rgba(0,0,0,0.8);">ADALEN</h1>
                                <p class="lead mb-4" style="text-shadow: 1px 1px 4px rgba(0,0,0,0.8); font-size: 1.1rem;">{{ 'home.hero.carousel.description'|trans }}</p>
                                <h2 class="display-5 fw-bold" style="color: white; text-shadow: 2px 2px 8px rgba(0,0,0,0.8);">{{ 'home.hero.carousel.keywords.nature'|trans }}</h2>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Slide 3: Culture -->
                <div class="carousel-item">
                    <div class="hero-slide" style="background-image: url('{{ asset('assets/img/hero.jpg') }}'); background-size: cover; background-position: center; min-height: 65vh; position: relative;">
                        <div class="hero-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4);"></div>
                        <div class="container" style="position: relative; z-index: 10; height: 65vh; display: flex; align-items: center; justify-content: center;">
                            <div class="text-center text-white">
                                <h1 class="display-3 fw-bold mb-2" style="color: var(--adalen-primary); text-shadow: 2px 2px 8px rgba(0,0,0,0.8);">ADALEN</h1>
                                <p class="lead mb-4" style="text-shadow: 1px 1px 4px rgba(0,0,0,0.8); font-size: 1.1rem;">{{ 'home.hero.carousel.description'|trans }}</p>
                                <h2 class="display-5 fw-bold" style="color: white; text-shadow: 2px 2px 8px rgba(0,0,0,0.8);">{{ 'home.hero.carousel.keywords.culture'|trans }}</h2>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Slide 4: Langage et dialogue -->
                <div class="carousel-item">
                    <div class="hero-slide" style="background-image: url('{{ asset('assets/img/hero.jpg') }}'); background-size: cover; background-position: center; min-height: 65vh; position: relative;">
                        <div class="hero-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4);"></div>
                        <div class="container" style="position: relative; z-index: 10; height: 65vh; display: flex; align-items: center; justify-content: center;">
                            <div class="text-center text-white">
                                <h1 class="display-3 fw-bold mb-2" style="color: var(--adalen-primary); text-shadow: 2px 2px 8px rgba(0,0,0,0.8);">ADALEN</h1>
                                <p class="lead mb-4" style="text-shadow: 1px 1px 4px rgba(0,0,0,0.8); font-size: 1.1rem;">{{ 'home.hero.carousel.description'|trans }}</p>
                                <h2 class="display-5 fw-bold" style="color: white; text-shadow: 2px 2px 8px rgba(0,0,0,0.8);">{{ 'home.hero.carousel.keywords.language'|trans }}</h2>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Slide 5: Leadership -->
                <div class="carousel-item">
                    <div class="hero-slide" style="background-image: url('{{ asset('assets/img/hero.jpg') }}'); background-size: cover; background-position: center; min-height: 65vh; position: relative;">
                        <div class="hero-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4);"></div>
                        <div class="container" style="position: relative; z-index: 10; height: 65vh; display: flex; align-items: center; justify-content: center;">
                            <div class="text-center text-white">
                                <h1 class="display-3 fw-bold mb-2" style="color: var(--adalen-primary); text-shadow: 2px 2px 8px rgba(0,0,0,0.8);">ADALEN</h1>
                                <p class="lead mb-4" style="text-shadow: 1px 1px 4px rgba(0,0,0,0.8); font-size: 1.1rem;">{{ 'home.hero.carousel.description'|trans }}</p>
                                <h2 class="display-5 fw-bold" style="color: white; text-shadow: 2px 2px 8px rgba(0,0,0,0.8);">{{ 'home.hero.carousel.keywords.leadership'|trans }}</h2>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Slide 6: Civisme -->
                <div class="carousel-item">
                    <div class="hero-slide" style="background-image: url('{{ asset('assets/img/hero.jpg') }}'); background-size: cover; background-position: center; min-height: 65vh; position: relative;">
                        <div class="hero-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4);"></div>
                        <div class="container" style="position: relative; z-index: 10; height: 65vh; display: flex; align-items: center; justify-content: center;">
                            <div class="text-center text-white">
                                <h1 class="display-3 fw-bold mb-2" style="color: var(--adalen-primary); text-shadow: 2px 2px 8px rgba(0,0,0,0.8);">ADALEN</h1>
                                <p class="lead mb-4" style="text-shadow: 1px 1px 4px rgba(0,0,0,0.8); font-size: 1.1rem;">{{ 'home.hero.carousel.description'|trans }}</p>
                                <h2 class="display-5 fw-bold" style="color: white; text-shadow: 2px 2px 8px rgba(0,0,0,0.8);">{{ 'home.hero.carousel.keywords.civism'|trans }}</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </section>

    <!-- Activities Section -->
    <section class="py-5" style="padding: 6rem 0;">
        <div class="container">
            <h2 class="section-title fade-in">{{ 'home.activities.title'|trans }}</h2>
            <p class="section-subtitle fade-in">{{ 'home.activities.subtitle'|trans }}</p>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4">
                    <div class="activity-card scale-in">
                        <img src="{{ asset('assets/img/image5.jpg') }}" alt="Jardinage" class="activity-image">
                        <div class="activity-card-content">
                            <div class="activity-icon"><i class="fas fa-trowel"></i></div>
                            <h3 class="activity-title">{{ 'activity.gardening.title'|trans }}</h3>
                            <p class="activity-description">{{ 'activity.gardening.description'|trans }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="activity-card scale-in">
                        <img src="{{ asset('assets/img/image3.jpg') }}" alt="Arts Plastiques" class="activity-image">
                        <div class="activity-card-content">
                            <div class="activity-icon"><i class="fas fa-paint-brush"></i></div>
                            <h3 class="activity-title">{{ 'activity.arts.title'|trans }}</h3>
                            <p class="activity-description">{{ 'activity.arts.description'|trans }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="activity-card scale-in">
                        <img src="{{ asset('assets/img/IMG_20251216_142928.jpg') }}" alt="Petites Bouchées Linguistiques" class="activity-image">
                        <div class="activity-card-content">
                            <div class="activity-icon"><i class="fas fa-language"></i></div>
                            <h3 class="activity-title">{{ 'activity.english.title'|trans }}</h3>
                            <p class="activity-description">{{ 'activity.english.description'|trans }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="activity-card scale-in">
                        <img src="{{ asset('assets/img/image2.jpg') }}" alt="{{ 'activity.archaeology.title'|trans }}" class="activity-image">
                        <div class="activity-card-content">
                            <div class="activity-icon"><i class="fas fa-monument"></i></div>
                            <h3 class="activity-title">{{ 'activity.archaeology.title'|trans }}</h3>
                            <p class="activity-description">{{ 'activity.archaeology.description'|trans }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="activity-card scale-in">
                        <img src="{{ asset('assets/img/IMG_20251216_130007.jpg') }}" alt="{{ 'activity.geology.title'|trans }}" class="activity-image">
                        <div class="activity-card-content">
                            <div class="activity-icon"><i class="fas fa-mountain"></i></div>
                            <h3 class="activity-title">{{ 'activity.geology.title'|trans }}</h3>
                            <p class="activity-description">{{ 'activity.geology.description'|trans }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="activity-card scale-in">
                        <img src="{{ asset('assets/img/IMG_20251118_135319.jpg') }}" alt="{{ 'activity.cultural.title'|trans }}" class="activity-image">
                        <div class="activity-card-content">
                            <div class="activity-icon"><i class="fas fa-landmark"></i></div>
                            <h3 class="activity-title">{{ 'activity.cultural.title'|trans }}</h3>
                            <p class="activity-description">{{ 'activity.cultural.description'|trans }}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center mt-5 fade-in">
                <a href="{{ path('app_activities', {_locale: app.request.locale}) }}" class="btn btn-primary btn-lg">
                    {{ 'home.activities.see_all'|trans }} <i class="fas fa-arrow-right ms-2"></i>
                </a>
            </div>
        </div>
    </section>


    <!-- Popup Actualité -->
    {% if latestActuality %}
    <div class="modal fade" id="actualityModal" tabindex="-1" aria-labelledby="actualityModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    {% set title = '' %}
                    {% if app.request.locale == 'fr' %}
                        {% set title = latestActuality.titleFr|default(latestActuality.titleEn|default(latestActuality.titleAr)) %}
                    {% elseif app.request.locale == 'en' %}
                        {% set title = latestActuality.titleEn|default(latestActuality.titleFr|default(latestActuality.titleAr)) %}
                    {% elseif app.request.locale == 'ar' %}
                        {% set title = latestActuality.titleAr|default(latestActuality.titleFr|default(latestActuality.titleEn)) %}
                    {% endif %}
                    {% if title and title|trim %}
                        <h5 class="modal-title" id="actualityModalLabel">
                            <i class="fas fa-newspaper me-2"></i>
                            {{ title }}
                        </h5>
                    {% else %}
                        <h5 class="modal-title" id="actualityModalLabel">
                            <i class="fas fa-newspaper me-2"></i>
                            {% if app.request.locale == 'fr' %}Actualité{% elseif app.request.locale == 'en' %}News{% else %}أخبار{% endif %}
                        </h5>
                    {% endif %}
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="actuality-content">
                        {% set description = '' %}
                        {% if app.request.locale == 'fr' %}
                            {% set description = latestActuality.descriptionFr|default(latestActuality.descriptionEn|default(latestActuality.descriptionAr)) %}
                        {% elseif app.request.locale == 'en' %}
                            {% set description = latestActuality.descriptionEn|default(latestActuality.descriptionFr|default(latestActuality.descriptionAr)) %}
                        {% elseif app.request.locale == 'ar' %}
                            {% set description = latestActuality.descriptionAr|default(latestActuality.descriptionFr|default(latestActuality.descriptionEn)) %}
                        {% endif %}
                        {% if description and description|trim %}
                            <p class="mb-3">{{ description|nl2br }}</p>
                        {% endif %}
                        
                        {% set hasImages = latestActuality.images and latestActuality.images|trim %}
                        {% set hasVideo = latestActuality.video and latestActuality.video|trim %}
                        {% set imageList = hasImages ? latestActuality.images|split(',') : [] %}
                        
                        {% if hasVideo or hasImages %}
                            <div class="actuality-media mb-3">
                                {% if hasVideo %}
                                    <!-- Vidéo seule (sans carousel) -->
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-center align-items-center" style="min-height: 300px; background: #000; border-radius: 8px;">
                                            <video controls class="w-100" style="max-height: 350px; border-radius: 8px;">
                                                <source src="{{ asset(latestActuality.video|trim) }}" type="video/mp4">
                                                Votre navigateur ne supporte pas la lecture de vidéos.
                                            </video>
                                        </div>
                                    </div>
                                {% endif %}
                                
                                {% if imageList|length > 0 %}
                                    {% if imageList|length > 1 %}
                                        <!-- Carousel pour plusieurs images -->
                                        <div id="actualityImagesCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="7000">
                                            <div class="carousel-inner rounded">
                                                {% for image in imageList %}
                                                    {% if image|trim %}
                                                        <div class="carousel-item {% if loop.first %}active{% endif %}">
                                                            <div class="d-flex justify-content-center align-items-center" style="min-height: 300px; background: #f8f9fa; border-radius: 8px;">
                                                                <img src="{{ asset(image|trim) }}" alt="{% if app.request.locale == 'fr' %}{{ latestActuality.titleFr|default('') }}{% elseif app.request.locale == 'en' %}{{ latestActuality.titleEn|default('') }}{% elseif app.request.locale == 'ar' %}{{ latestActuality.titleAr|default('') }}{% endif %}" class="img-fluid" style="max-height: 350px; width: auto; object-fit: contain;">
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                            <button class="carousel-control-prev" type="button" data-bs-target="#actualityImagesCarousel" data-bs-slide="prev">
                                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Précédent</span>
                                            </button>
                                            <button class="carousel-control-next" type="button" data-bs-target="#actualityImagesCarousel" data-bs-slide="next">
                                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Suivant</span>
                                            </button>
                                            <div class="carousel-indicators">
                                                {% for image in imageList %}
                                                    {% if image|trim %}
                                                        <button type="button" data-bs-target="#actualityImagesCarousel" data-bs-slide-to="{{ loop.index0 }}" {% if loop.first %}class="active" aria-current="true"{% endif %} aria-label="Image {{ loop.index }}"></button>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% else %}
                                        <!-- Affichage simple pour une seule image -->
                                        <div class="d-flex justify-content-center align-items-center" style="min-height: 300px; background: #f8f9fa; border-radius: 8px;">
                                            <img src="{{ asset(imageList[0]|trim) }}" alt="{% if app.request.locale == 'fr' %}{{ latestActuality.titleFr|default('') }}{% elseif app.request.locale == 'en' %}{{ latestActuality.titleEn|default('') }}{% elseif app.request.locale == 'ar' %}{{ latestActuality.titleAr|default('') }}{% endif %}" class="img-fluid" style="max-height: 350px; width: auto; object-fit: contain;">
                                        </div>
                                    {% endif %}
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {% if latestActuality %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const modalElement = document.getElementById('actualityModal');
            if (!modalElement) return;
            
            const modal = new bootstrap.Modal(modalElement);
            const actualityId = {{ latestActuality.id }};
            const storageKey = 'adalen_last_actuality_id';
            
            // Récupérer l'ID de la dernière actualité vue
            const lastSeenActualityId = localStorage.getItem(storageKey);
            
            // Afficher la popup à chaque rafraîchissement
            // Si c'est une nouvelle actualité, elle remplacera l'ancienne automatiquement
            setTimeout(function() {
                modal.show();
            }, 1000);
            
            // Mettre à jour l'ID de la dernière actualité vue quand la popup est fermée
            modalElement.addEventListener('hidden.bs.modal', function() {
                localStorage.setItem(storageKey, actualityId.toString());
            });
        });
    </script>
    {% endif %}
{% endblock %}
